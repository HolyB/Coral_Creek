name: Intraday Portfolio Monitor

on:
  # å®šæ—¶è§¦å‘ - ç¾ä¸œæ—¶é—´ç›˜ä¸­æ¯30åˆ†é’Ÿ
  schedule:
    # æ¯4å°æ—¶è¿è¡Œä¸€æ¬¡ (å‘¨ä¸€è‡³å‘¨äº”)
    - cron: '0 */4 * * 1-5'
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# æƒé™
permissions:
  contents: read

env:
  POLYGON_API_KEY: ${{ secrets.POLYGON_API_KEY }}
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}


jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f versions/v2/requirements.txt ]; then pip install -r versions/v2/requirements.txt; fi
      
      - name: Run intraday monitor
        working-directory: versions/v2
        env:
          TZ: America/New_York
          PYTHONPATH: ${{ github.workspace }}/versions/v2
        run: |
          echo "ğŸ• Current time (ET): $(TZ='America/New_York' date)"
          python scripts/intraday_monitor.py

name: Intraday Portfolio Monitor

on:
  # å®šæ—¶è§¦å‘ - ç¾ä¸œæ—¶é—´ç›˜ä¸­æ¯30åˆ†é’Ÿ
  schedule:
    # ç¾ä¸œ 9:30 AM - 4:00 PM = UTC 14:30 - 21:00
    # æ¯30åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
    - cron: '0 14 * * 1-5'      # 9:00 AM ET
    - cron: '30 14 * * 1-5'     # 9:30 AM ET (å¼€ç›˜)
    - cron: '0 15 * * 1-5'      # 10:00 AM ET
    - cron: '30 15 * * 1-5'     # 10:30 AM ET
    - cron: '0 16 * * 1-5'      # 11:00 AM ET
    - cron: '30 16 * * 1-5'     # 11:30 AM ET
    - cron: '0 17 * * 1-5'      # 12:00 PM ET
    - cron: '30 17 * * 1-5'     # 12:30 PM ET
    - cron: '0 18 * * 1-5'      # 1:00 PM ET
    - cron: '30 18 * * 1-5'     # 1:30 PM ET
    - cron: '0 19 * * 1-5'      # 2:00 PM ET
    - cron: '30 19 * * 1-5'     # 2:30 PM ET
    - cron: '0 20 * * 1-5'      # 3:00 PM ET
    - cron: '30 20 * * 1-5'     # 3:30 PM ET
    - cron: '0 21 * * 1-5'      # 4:00 PM ET (æ”¶ç›˜)
  
  # æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# æƒé™
permissions:
  contents: read

env:
  POLYGON_API_KEY: ${{ secrets.POLYGON_API_KEY }}
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}


jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f versions/v2/requirements.txt ]; then pip install -r versions/v2/requirements.txt; fi
      
      - name: Run intraday monitor
        working-directory: versions/v2
        env:
          TZ: America/New_York
          PYTHONPATH: ${{ github.workspace }}/versions/v2
        run: |
          echo "ğŸ• Current time (ET): $(TZ='America/New_York' date)"
          python scripts/intraday_monitor.py

name: Intraday Portfolio Monitor

on:
  # ÂÆöÊó∂Ëß¶Âèë - Áæé‰∏úÊó∂Èó¥Áõò‰∏≠ÊØè30ÂàÜÈíü
  schedule:
    # AËÇ°Êó∂Èó¥ (UTC+8 9:30-11:30, 13:00-15:00) => UTC 1:30-3:30, 5:00-7:00
    - cron: '30 1 * * 1-5'      # 9:30 AM CN
    - cron: '0 2 * * 1-5'       # 10:00 AM CN
    - cron: '30 2 * * 1-5'      # 10:30 AM CN
    - cron: '0 3 * * 1-5'       # 11:00 AM CN
    - cron: '30 3 * * 1-5'      # 11:30 AM CN
    - cron: '0 5 * * 1-5'       # 1:00 PM CN
    - cron: '30 5 * * 1-5'      # 1:30 PM CN
    - cron: '0 6 * * 1-5'       # 2:00 PM CN
    - cron: '30 6 * * 1-5'      # 2:30 PM CN
    - cron: '0 7 * * 1-5'       # 3:00 PM CN (Êî∂Áõò)
    
    # Áæé‰∏ú 9:30 AM - 4:00 PM = UTC 14:30 - 21:00
    - cron: '30 14 * * 1-5'     # 9:30 AM ET (ÂºÄÁõò)
    - cron: '0 15 * * 1-5'      # 10:00 AM ET
    - cron: '30 15 * * 1-5'     # 10:30 AM ET
    - cron: '0 16 * * 1-5'      # 11:00 AM ET
    - cron: '30 16 * * 1-5'     # 11:30 AM ET
    - cron: '0 17 * * 1-5'      # 12:00 PM ET
    - cron: '30 17 * * 1-5'     # 12:30 PM ET
    - cron: '0 18 * * 1-5'      # 1:00 PM ET
    - cron: '30 18 * * 1-5'     # 1:30 PM ET
    - cron: '0 19 * * 1-5'      # 2:00 PM ET
    - cron: '30 19 * * 1-5'     # 2:30 PM ET
    - cron: '0 20 * * 1-5'      # 3:00 PM ET
    - cron: '30 20 * * 1-5'     # 3:30 PM ET
    - cron: '0 21 * * 1-5'      # 4:00 PM ET (Êî∂Áõò)
  
  # ÊâãÂä®Ëß¶Âèë
  workflow_dispatch:

# ÊùÉÈôê
permissions:
  contents: read

env:
  POLYGON_API_KEY: ${{ secrets.POLYGON_API_KEY }}
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}


jobs:
  monitor:
    runs-on: ubuntu-latest
    timeout-minutes: 10
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'
          cache: 'pip'
      
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          if [ -f versions/v2/requirements.txt ]; then pip install -r versions/v2/requirements.txt; fi
      
      - name: Run intraday monitor
        working-directory: versions/v2
        env:
          TZ: America/New_York
          PYTHONPATH: ${{ github.workspace }}/versions/v2
        run: |
          echo "üïê Current time (ET): $(TZ='America/New_York' date)"
          python scripts/intraday_monitor.py

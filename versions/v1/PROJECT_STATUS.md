# Coral Creek V1 - 项目状态与未来规划

## 📅 当前版本 (V1.5) 完成情况
**版本目标**：建立一个基于信号扫描（BLUE趋势+黑马反转）的股票监控与分析系统，并具备初步的策略验证（回测）能力。

### 1. 核心扫描引擎
- [x] **美股扫描器 (`scan_us_signals.py`)**:
    - 数据源切换至 Polygon API，解决 yfinance 限制。
    - 实现多线程并发扫描，大幅提升速度。
    - 策略逻辑：日线/周线 BLUE 趋势信号 + 黑马/掘底反转信号。
    - 记录信号出现的具体日期序列。
- [x] **A股扫描器 (`scan_cn_signals_blue_only.py`)**:
    - 数据源使用 Tushare API。
    - 保持与美股相同的信号逻辑配置。
    - 支持分批次扫描和断点续传。

### 2. 数据存储与管理
- [x] **SQLite 数据库**: 统一存储美股和A股的扫描结果。
- [x] **JSON 数据结构**: 存储复杂的信号日期列表和对应数值。
- [x] **配置管理**: 使用 `config.json` 统一管理 API Key 和邮件配置。

### 3. 前端可视化 (Streamlit App)
- [x] **信号监控看板**:
    - 支持按市场、价格、成交额、信号类型（日/周）、信号强度进行高级筛选。
    - 显示详细的信号日期列表。
- [x] **交互式图表**:
    - 集成 Plotly K线图。
    - **独家功能**: 在K线图上叠加 BLUE 信号趋势线和信号点标注。
    - **筹码分布 (Volume Profile)**: 支持动态调整时间范围的筹码分布图，辅助判断支撑压力。
- [x] **自选股系统**:
    - 独立的“自选股看板”，无论是否有信号均可查看行情。
    - 在扫描列表中快速添加/移除自选。
- [x] **统计分析**:
    - 历史数据对比（查看新增/消失信号）。
    - 信号分布统计和市场概况。

### 4. 策略回测与优化 (Backtesting & Optimization)
- [x] **简易回测引擎 (`simple_backtest.py`)**:
    - 实现 **BLUE 趋势 + 黑马反转** 混合策略回测。
    - 严谨处理周线数据的“未来函数”问题（Look-ahead Bias Mitigation）。
    - 交易逻辑：全仓买入/卖出，考虑佣金。
    - 输出指标：总回报、年化回报、最大回撤、胜率。
- [x] **策略增强 (Strategy Enhancement)**:
    - **筹码分布过滤 (VP Filter)**: 在回测中集成 Volume Profile 指标，自动过滤掉上方套牢盘重或受制于 POC 的假突破信号。
    - **信号共振**: 支持“必须包含黑马/掘底”或“必须周线共振”的严格模式。
- [x] **诊断与解释 (Explainability)**:
    - **回测诊断报告**: 记录并展示所有“满足基础信号但被高级条件过滤”的潜在交易及其拒绝原因（如“筹码获利盘不足”）。
- [x] **自适应阈值 (Adaptive Thresholds)**:
    - 基于历史波动率（Volatility）自动推荐 BLUE 信号的最佳触发阈值。
    - 提供网格搜索脚本 (`optimize_thresholds.py`) 寻找最优参数。

### 5. 通知系统
- [x] **邮件通知**:
    - 扫描结束后自动发送 HTML 格式报告。
    - **智能高亮**: 优先展示自选股中的信号命中情况。
    - 包含详细的 BLUE 和 黑马信号列表。

---

## 🚀 迈向完整量化系统的差距 (Gap Analysis)

### 1. 实盘/模拟交易执行 (Execution System)
- **现状**: 仅提供信号和回测，需人工下单。
- **需求**:
    - 对接券商 API (如 Interactive Brokers, 富途牛牛, 老虎证券)。
    - 实现自动下单 (Order Placement)。
    - 订单状态管理 (Filled, Cancelled, Rejected)。
    - 风控模块：自动止损、止盈、最大持仓限制。

### 2. 实时性与数据增强 (Real-time Data)
- **现状**: 基于日线/周线数据，属于盘后或低频分析。
- **需求**:
    - 引入分钟级数据 (Intraday Data) 用于更精准的择时。
    - 实时 WebSocket 数据流，实现盘中即时预警（而非跑批处理）。

### 3. 策略开发平台 (Strategy Factory)
- **现状**: 策略逻辑硬编码在扫描和回测脚本中。
- **需求**:
    - 策略解耦：将 `BLUE`、`Heima` 封装为独立的策略类。
    - 支持用户通过配置文件或简单的 Python 脚本添加新指标/新策略，无需修改核心代码。

## 📝 待办事项 (Todos)
1. **[Pending] 可视化增强**: 在回测K线图上标记被过滤的信号点，并用 Tooltip 显示拒绝原因。
2. **UI 优化**: 统一深色模式，优化移动端体验。
3. **实盘对接**: 调研 IBKR API 对接可行性。
